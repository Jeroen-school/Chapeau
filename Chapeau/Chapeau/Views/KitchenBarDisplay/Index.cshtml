@model List<Chapeau.Models.Order>
@{
	if (ViewBag.Rol.ToLower() == "kitchen")
	{
		ViewData["Title"] = "Kitchen";
	}
	else
	{
		ViewData["Title"] = "Bar";
	}
}

<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h1 class="mb-0">@ViewBag.Rol Display</h1>
    </div>

    <!-- Tabs -->
    @await Html.PartialAsync("_OrderTabs")

    <!-- Orders -->
    <div class="row g-4" id="orders-container">
		@await Html.PartialAsync("_OrdersPartial", Model)
    </div>
</div>

@section Scripts {
    <!--SignalR script reference.-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/7.0.5/signalr.min.js"></script>

    <!--SignalR connection setup.-->
    <script>
        const connection = new signalR.HubConnectionBuilder()
            .withUrl("/orderHub")
            .build();

        connection.start().catch(err => console.error(err.toString()));

        connection.on("ReceiveOrders", function () {
            // Fetch updated partial via AJAX
            fetch("/KitchenBarDisplay/OrdersPartial")
                .then(response => response.text())
                .then(html => {
                    document.getElementById("orders-container").innerHTML = html;
                });
        });
    </script>
}
